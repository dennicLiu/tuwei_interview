# tuwei_interview
tuwei interview
# 项目概述
本游戏排行榜系统旨在为游戏提供实时的分数更新、准确的排名计算以及高效的 WebSocket 消息推送功能，以满足玩家对实时排名变化的需求。系统支持高并发场景，具备良好的性能、数据一致性和扩展性。
# 技术选型及理由
1. WebSocket 实现
WebSocket 是一种能提供全双工通信、具备跨平台兼容性的网络通信协议，虽不像 Socket.IO 自带广播、房间等功能，但可通过自行设计实现相应机制来满足实时消息推送等实时应用需求。
2. 数据存储
Redis：具有高性能的读写速度，支持丰富的数据结构。利用 Redis 的有序集合可以方便地实现排行榜功能，快速处理分数更新和排名计算操作。
关系型数据库（如 MySQL）：用于持久化存储玩家的分数、排名等信息，方便进行复杂的数据查询和分析，同时可作为数据备份。
4. 排序算法
基于二叉堆的数据结构和算法：适合对排行榜这种需要频繁更新和部分排序的场景，能在插入和删除元素时以较低的时间复杂度调整排名。
# 性能测试方案
1. 单游戏 300 TPS 分数更新测试
使用压力测试工具（如 Apache JMeter）模拟游戏服务器以一定的频率（每秒 300 次请求）向排行榜系统发送分数更新请求，监测系统的响应时间和处理成功率。
观察 Redis 的写入性能、后端服务的资源使用情况以及是否有请求积压等问题。
2. 排行榜查询接口响应时间测试
使用性能测试工具对排行榜查询接口进行多次并发请求，记录响应时间，确保平均响应时间小于 100ms。
分析缓存命中率、数据库查询时间等因素对响应时间的影响。
3. WebSocket 消息推送延迟测试
在客户端模拟大量玩家连接，触发排名变化事件，测量从排名变化到客户端收到消息的时间延迟，确保小于 100ms。
检查消息队列的处理效率、WebSocket 连接的稳定性等因素。
4. 并发 WebSocket 连接测试
使用多台客户端设备同时建立 WebSocket 连接，逐渐增加连接数量，测试系统在 3000+ 并发连接下的稳定性和性能。
观察服务器的资源占用、连接管理机制的有效性等。
5. 系统可用性测试
持续运行系统一段时间，模拟各种业务场景和异常情况，统计系统的正常运行时间占总时间的比例，确保可用性大于 99.9%。
监测服务器的故障恢复时间、数据备份和恢复机制的可靠性等。
#  遇到的问题和解决方案
1. 性能瓶颈问题
问题描述：在高并发情况下，分数更新和排名计算可能导致性能瓶颈，影响系统的响应时间和吞吐量。
解决方案：
利用 Redis 的管道技术批量处理分数更新请求，减少网络往返次数。
采用多进程或多线程模型处理请求，充分利用多核 CPU 资源。
对排行榜数据进行缓存和预计算，减少实时计算排名的次数。
2. WebSocket 连接不稳定问题
问题描述：大量并发的 WebSocket 连接可能导致连接不稳定，出现消息推送延迟或连接断开的情况。
解决方案：
选用高效的 WebSocket 库并进行合理配置，如调整缓冲区大小和连接超时时间。
建立连接池管理 WebSocket 连接，及时清理异常连接。
采用消息队列和异步推送机制，确保消息推送的及时性。
3. 数据一致性问题
问题描述：在分数更新、排名计算和消息推送过程中，可能出现数据不一致的情况，影响排名的准确性和消息的可靠性。
解决方案：
增加数据校验环节，对比不同算法的计算结果，确保排名计算的准确性。
采用消息确认和重传机制，保证消息推送的可靠性。
处理网络异常情况，实现客户端重连后的数据同步。
# 有限时间内做出的 tradeoff 决策说明
在有限的时间内，为了快速实现系统的核心功能并满足性能要求，我们做出了以下 tradeoff 决策：
选择了相对成熟且易于使用的技术栈，如 Express 和 Socket.IO，虽然可能不是性能最优的选择，但能够快速开发和部署系统。
在数据一致性方面，优先保证排名计算的准确性和消息推送的可靠性，对于一些极端情况下的数据不一致问题，可以通过后续的监控和人工干预来解决。
在扩展性方面，采用了较为简单的水平扩展方案，如增加服务器实例和调整数据库配置，而没有深入实现复杂的分布式架构，以节省开发时间。
# 如果今后获得更多时间的情况下，该项目可以继续做的功能或优化
1. 功能增强
增加玩家互动功能，如玩家之间的挑战、排行榜评论等。
提供更详细的数据分析功能，如玩家分数分布、排名变化趋势等。
2. 性能优化
进一步优化排序算法，提高排名计算的效率。
采用更先进的缓存策略，如分布式缓存和缓存预热技术。
3. 系统可靠性提升
实现自动化的故障检测和恢复机制，减少人工干预的需求。
加强系统的安全防护，防止恶意攻击和数据泄露。
通过以上设计和实现，本游戏排行榜系统能够满足游戏的实时性和高并发需求，为玩家提供良好的游戏体验。同时，我们也在不断优化和改进系统，以适应不断变化的业务需求和技术发展。